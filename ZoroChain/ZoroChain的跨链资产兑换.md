# ZoroChain的跨链资产兑换
### 总体思路
* 跨链资产兑换需要解决的核心问题
  * 把资产从一条链转移到另一条链上，需要先在转出链上预存需要转出的等量货币，再到转入链上提取这笔货币
  * 在转入链上提取货币时，需要验证转出链上有对应的预存转账
  * 但是转入链所在的节点可能并不没有同步转入链的数据，从而无法直接验证转账人是否进行了预存
  * 需要有一种可信赖的方式，在不同步转入链数据的前提下，能够验证这笔预存转账 
* 跨链资产兑换的解决方案
  * 通过引入多个公证人，由公正人来对预存转账进行公正，提供凭证
  * 当有足够数量的公证人共同公示了一笔预存转账时，其他节点可以信赖这笔预存转账的真实性

### 跨链资产兑换的相关概念
* 转出链
  * 资产转出的链
* 转入链
  * 资产要转入的链
* 转账人账户
  * 需要做跨链资产兑换的账户
* 公正人
  * 验证转账人的预存转账，并发布公示的节点
  * 根链和应用链的公证人是由管理员来设定
* 预存交易
  * 进行跨链转账时，先要在转出链上预存需要转出的等量货币
* 公示交易
  * 由公正人发起的，对预存交易在转入链上进行公示的交易
* 放款交易
  * 用公示交易作为凭证，在转出链上提取预存款

### 跨链资产兑换的流程
* 转账程序先在转出链上发起一笔交易，把一定金额的货币转入到该货币的特定兑换账户
  * 在交易的备注里标记要转入链的Hash，以及请求公证人公正这笔交易
* 转出链的公证人节点同步到这笔交易后，会在转入链上发起一笔交易用于公示这笔预存转账
  * 这笔交易里会记录预存转账的信息，包括转出链Hash，转入链Hash，预存转账的交易Id，预存人账户，预存金额
  * 在上链时，共识节点对公示交易不做验证，只检查公证人的身份是否合法，并检查公证人的签名
* 转账程序在转入链上同步到公示交易后，会判断公证人身份是否合法，以及是否有足够数量的公证人公正了这笔预存转账
  * 可以通过db查询得到每条链的合法公证人列表
  * 类似dBFT共识算法，如果转出链有4个公证人，当有3个公正人公示时即可认为这个公示是可信任的
* 当达到了足够数量的公证人时，在根链上发起放款交易，要求向预存人的根链账户上发放预存款
  * 放款交易里记录所有已上链的公示交易的Id，检查通过后方可上链
  * 在放款的同时，在根链上记录该笔预存款已被使用，防止重复提款

### 公证人的选取
* 公证人机制的安全性是建立在公证人私钥不被泄露，已经公证人不会被单方面掌控的基础上
* 为了保证安全性和公正性，公证人不应该由某一方全部掌控，可以参考银行的双人提款机制，最少由两方来共同管理
* 出于安全性考虑，Zoro官方管理的公证人数量不能小于总数的50%

### 根链的公证人
* 根链的公证人需要对根链上的跨链预存交易进行公正，并将结果在应用链上公示
* 根链的公证人由两个部分组成，一部分是由Zoro官方管理，另一部分是从社区选出并管理

### 应用链的公证人
* 应用链的公正人需要对应用链上的跨链预存交易进行公正
* 应用链的公证人至少由两部分组成，一部分是由Zoro官方管理，另一部分是由应用链的所有者管理
* 除此之外，还可以由社区选出的第三方来提供一部分的公证人
